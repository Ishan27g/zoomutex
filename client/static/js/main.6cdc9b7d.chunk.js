(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{104:function(e,n,t){"use strict";t.r(n);var r=t(2),o=t(50),c=t(11),a=(t(59),t(51)),i=t.n(a),s=t(0),u=t.n(s),l=new i.a("",{host:window.location.hostname,path:"/peerjs",port:443}),d=u.a.createContext(l),j=t(52),f=Object(j.io)(window.location.origin),b=u.a.createContext(f),O=t(1),m=function(e){var n=e.children;return Object(O.jsx)(b.Provider,{value:f,children:Object(O.jsx)(d.Provider,{value:l,children:n})})},v=function(e){var n=e.mediaStream,t=e.isCamera,r=void 0!==t&&t,o=Object(s.useRef)(null);return o.current&&(o.current.srcObject=n),Object(O.jsx)("video",{style:{border:r?"5px solid red":void 0},autoPlay:!0,playsInline:!0,ref:o})},p=function(e){var n=e.streams,t=[];for(var r in n)n.hasOwnProperty(r)&&t.push(Object(O.jsx)(v,{mediaStream:n[r]},r));return Object(O.jsx)(O.Fragment,{children:t})},h="/join/:roomId",x=t(58),g=t(57),w=t(21),I=t(23);var C=t(29),y=t.n(C),k=t(53),E=function(e){var n=Object(s.useState)(null),t=Object(c.a)(n,2),r=t[0],o=t[1];return Object(s.useEffect)((function(){if(r)return function(){null===r||void 0===r||r.getTracks().forEach((function(e){return e.stop()}))};(function(){var n=Object(k.a)(y.a.mark((function n(){var t;return y.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,navigator.mediaDevices.getUserMedia(e);case 3:t=n.sent,o(t),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),console.error(n.t0);case 10:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(){return n.apply(this,arguments)}})()()}),[r,e]),r},S=function(){var e=Object(r.g)(h),n=Object(s.useState)(null===e||void 0===e?void 0:e.params.roomId),t=Object(c.a)(n,1)[0],a=Object(s.useContext)(b),i=Object(s.useContext)(d),u=E({audio:!0,video:!0}),l=function(e,n){var t=Object(s.useState)({}),r=Object(c.a)(t,2),o=r[0],a=r[1];return[Object(s.useCallback)((function(t){if(void 0!==t)if(null!==n){var r=e.call(t,n);r.on("stream",(function(e){a((function(n){return Object(I.a)(Object(I.a)({},n),{},Object(w.a)({},t,e))}))})),r.on("close",(function(){a((function(e){e[t];var n=Object(x.a)(e,[t].map(g.a));return Object(I.a)({},n)}))}))}else console.error("userMediaStream was null");else console.error("userId was undefined")}),[e,n]),o]}(i,u),j=Object(c.a)(l,2),f=j[0],m=j[1],C=Object(s.useRef)([]);Object(s.useEffect)((function(){console.log("calling ".concat(C.current.length," deferred user ids"));var e,n=Object(o.a)(C.current);try{for(n.s();!(e=n.n()).done;){var t=e.value;f(t)}}catch(r){n.e(r)}finally{n.f()}C.current=[]}),[f]);var y=Object(s.useCallback)((function(e){var n=e.userId;if(console.log("user attempting to connect"),n){if(!u)return C.current.push(n),void console.log("deferred userId ".concat(n," while waiting for media stream"));console.log("calling peer"),f(n)}else console.error("user was invalid")}),[f,u]);return Object(s.useEffect)((function(){t&&u?(console.log("joining room"),a.emit("join-room",{roomId:t,userId:i.id}),a.on("user-connected",y),i.on("open",(function(e){a.emit("join-room",{roomId:t,userId:e})})),i.on("call",(function(e){e.answer(u)}))):console.log("waiting for user media stream")}),[y,i,t,a,u]),Object(s.useEffect)((function(){window.onbeforeunload=function(){console.log("cleaning up"),a.disconnect(),i.destroy()}}),[i,a]),null!==e&&e.params.roomId?Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{className:"room-title",children:["Room ",e.params.roomId]}),Object(O.jsxs)("div",{className:"video-grid",children:[Object(O.jsx)(v,{mediaStream:u,isCamera:!0}),Object(O.jsx)(p,{streams:m})]})]}):Object(O.jsx)("div",{children:"Invalid room"})},F=t(106),P=function(){var e=Object(F.a)();return Object(O.jsx)(r.a,{to:h.replace(":roomId",e)})},D=t(55),N=function(){return Object(O.jsx)(D.a,{children:Object(O.jsxs)(r.d,{children:[Object(O.jsx)(r.b,{path:"/",exact:!0,component:P}),Object(O.jsx)(r.b,{path:h,exact:!0,component:S})]})})},T=t(56),L=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,107)).then((function(n){var t=n.getCLS,r=n.getFID,o=n.getFCP,c=n.getLCP,a=n.getTTFB;t(e),r(e),o(e),c(e),a(e)}))};t.n(T).a.render(Object(O.jsx)(m,{children:Object(O.jsx)(N,{})}),document.getElementById("root")),L()},59:function(e,n,t){},60:function(e,n){function t(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=60}},[[104,1,2]]]);
//# sourceMappingURL=main.6cdc9b7d.chunk.js.map